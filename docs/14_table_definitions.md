# 2025年度 DPC 提出データ テーブル定義と差分確認

本書は、厚生労働省が公開している「2025年度 DPC（退院患者調査）提出データ」仕様に基づき、DPC データ学習基盤で取り扱う予定のテーブル設計を整理したものです。公式定義との齟齬がないかを確認し、現行 DDL（`ddl/core/raw_tables.sql` など）との差分も併記します。

- 参照資料: 2025 年度 DPC 提出データ仕様書（様式1/3/4、EF、D、H、K ファイル）
- データ格納形式: 原則タブ区切りテキスト（K ファイル生成用データのみ CSV）
- 文字コード: UTF-8 を想定

以下では、公式資料に沿ってテーブル A〜G を整理し、それぞれの Redshift 物理型（想定）と現状テーブルの対応状況を示します。

---

## 1. 様式1（患者属性・病態等）

様式1はヘッダ（レコード識別キー）とペイロードの 2 種類のレコードで構成されます。

### 1.1 テーブル A-1: 様式1 ヘッダ情報（レコード識別キー）

想定テーブル: `raw.y1_header`

| 項目名 | 必須/条件 | 桁数 | 説明 | 推奨 Redshift 型 | 現行 DDL 対応 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| 施設コード | 必須 | 9 | 都道府県番号 2 桁 + 医療機関コード 7 桁（前ゼロ必須）。 | `CHAR(9)` | `raw.y1_inpatient.facility_cd` として存在 |
| データ識別番号 | 必須 | 10 | 匿名化患者 ID（前ゼロ必須）。1 患者 = 1 ID。 | `CHAR(10)` | `raw.y1_inpatient.data_id` として存在 |
| 入院年月日 | 必須 | 8 | 入院日。`YYYYMMDD` 形式。 | `CHAR(8)` （又は `DATE`） | `raw.y1_inpatient.admission_date` は `DATE` 型で存在 |
| 回数管理番号 | 必須 | 1 | 同日入退院でない症例は「0」。同日入退院は「1〜」。 | `CHAR(1)` | **未実装** |
| 統括診療情報番号 | 必須 | 1 (文字) | 入院サマリ「0」、転棟「1〜」、再入院集約「A/B」。 | `CHAR(1)` | **未実装** |

### 1.2 テーブル A-2: 様式1 ペイロード詳細

想定テーブル: `raw.y1_payload`

| 項目名 | 必須/条件 | 桁数 | 説明 | 推奨 Redshift 型 | 備考 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| レコード識別キー | 必須 | 複合 | テーブル A-1 の 5 項目を連結したキー。 | `SUPER`/`VARCHAR` | 物理実装では個別列として保持予定 |
| コード | 必須 | 可変 | ペイロード種別を示すコード（例: `A000010`）。 | `VARCHAR(16)` | |
| バージョン | 必須 | 8 | コード新設年度（例: `20240601`）。 | `CHAR(8)` | |
| 連番 | 必須 | 1 (文字) | 規定されている場合はレコード順に「1」〜、規定外は「0」。 | `CHAR(1)` | |
| ペイロード1〜9 | 条件付/任意 | 可変長 | コードで規定された内容。情報がない場合は Null。 | `VARCHAR(4000)` | 列を `payload_1` 〜 `payload_9` として用意 |

**現行 DDL 差分**
- `raw.y1_inpatient` はヘッダとペイロードの情報を混在した簡易テーブルであり、公式仕様で求められる回数管理番号・統括診療情報番号・ペイロードの可変項目が不足しています。
- `raw` スキーマにヘッダ・ペイロードを分割したテーブルが未定義のため、DDL の再設計が必要です。

---

## 2. 様式3（施設情報）

### テーブル B: 様式3 施設情報

想定テーブル: `raw.y3_facility`

| 項目名 | 必須/条件 | 桁数/形式 | 説明 | 推奨 Redshift 型 | 現行 DDL 対応 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| 施設コード | 必須 | 9 桁 | 医療機関コード。 | `CHAR(9)` | `raw.y3_facility.facility_cd` として存在 |
| 調査年月 | 必須 | `YYYYMM` (6 桁) | 調査対象年月。 | `CHAR(6)` | **未実装**（`report_year` 列のみ） |
| 施設名 | 必須 | 文字列 | 医療機関名称。 | `VARCHAR(255)` | `facility_name` 列あり |
| 病院情報 URL | 条件付 | 文字列 | 「病院情報の公表」を公開している場合の URL。 | `VARCHAR(512)` | **未実装** |
| 開設者コード | 必須 | 1 桁 | 1: 国立、5: 医療法人 など。 | `CHAR(1)` | **未実装** |
| 許可病床数 | 必須 | 数値 | 医療法上の許可病床数（区分別）。 | `INTEGER` | **未実装** |
| 届出病床数 | 必須 | 数値 | 届出病床総数・その他・休止など。 | `INTEGER` | **未実装** |
| 届出入院料 | 必須/条件付 | 数値/コード | 入院料ごとの届出病床数または算定可能性（○/×）。 | `VARCHAR(64)` | **未実装** |
| 看護必要度評価票 | 条件付 | 1 桁/文字 | 重症度、医療・看護必要度 I/II の評価状況。 | `CHAR(1)` | **未実装** |
| 病棟情報（病棟コード設定） | 必須 | 文字列/コード | 届出入院料や病床機能報告コードなどの組合せ。 | `VARCHAR(255)` | **未実装** |
| 転倒・転落発生件数 | 任意 | 数値 | 調査期間中の転倒・転落件数。 | `INTEGER` | **未実装** |
| 褥瘡新規発生患者数 | 任意 | 数値 | d2 以上の褥瘡新規発生患者数。 | `INTEGER` | **未実装** |

**現行 DDL 差分**
- `raw.y3_facility` は最小限の属性（年度・名称・所在地）しか保持しておらず、公式仕様の詳細項目が欠落しています。
- 調査年月は `report_year` として 4 桁で保存されているため、6 桁形式への修正が必要です。

---

## 3. 様式4（医科保険診療以外の情報）

### テーブル C: 様式4 医科保険外情報

想定テーブル: `raw.y4_noncovered`

| 項目名 | 必須/条件 | 桁数 | 説明 | 推奨 Redshift 型 | 現行 DDL 対応 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| 施設コード | 必須 | 9 | 医療機関コード。 | `CHAR(9)` | `raw.y4_noncovered.facility_cd` あり |
| データ識別番号 | 必須 | 10 | 様式1と同一の匿名 ID。 | `CHAR(10)` | `data_id` あり |
| 入院年月日 | 必須 | 8 | `YYYYMMDD`。 | `CHAR(8)`/`DATE` | `admission_date` 列 **未実装** |
| 退院年月日 | 必須 | 8 | `YYYYMMDD`。 | `CHAR(8)`/`DATE` | `discharge_date` 列 **未実装** |
| 医療保険外との組合せ | 必須 | 1 | 1: 医科レセプトのみ、4: 保険＋他制度、5: その他。 | `CHAR(1)` | `noncovered_reason` は 2 桁コードのため要修正 |

**現行 DDL 差分**
- 入退院日を保持する列が欠落。
- 医療保険外区分が 2 桁コードで定義されているため、公式仕様に合わせた 1 桁コードと名称の整理が必要です。

---

## 4. 入院 EF 統合ファイル（診療明細）

### テーブル D: 入院 EF 統合行為明細情報

想定テーブル: `raw.ef_inpatient`

| 項目名 | 必須/条件 | 桁数 (最大) | 説明 | 推奨 Redshift 型 | 現行 DDL 対応 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| 施設コード | 必須 | 9 | 施設識別子。 | `CHAR(9)` | あり |
| データ識別番号 | 必須 | 10 | 様式1と同一 ID。 | `CHAR(10)` | あり |
| 退院年月日 | 必須 | 8 | 入院継続中は `00000000`。 | `CHAR(8)`/`DATE` | **未実装** |
| 入院年月日 | 必須 | 8 | `YYYYMMDD`。 | `CHAR(8)`/`DATE` | **未実装** |
| データ区分 | 必須 | 2 | 診療識別コード（例: 40 処置）。 | `CHAR(2)` | **未実装** |
| 順序番号 | 必須 | 4 | データ区分別に連番。 | `INTEGER` | `seq_no` は整数列として存在 |
| 行為明細番号 | 必須 | 3 | 順序番号内の詳細連番 (001-999)。 | `SMALLINT` | `detail_no` は整数型（スケール要確認） |
| レセプト電算コード | 必須 | 9 | 電算処理システム用コード。 | `CHAR(9)` | `service_code` は `VARCHAR(12)` のため要修正 |
| 解釈番号 | 任意 | 8 | 点数表コード等。 | `VARCHAR(8)` | **未実装** |
| 診療明細名称 | 必須 | 254 | 行為/薬剤/材料の名称。 | `VARCHAR(254)` | **未実装** |
| 使用量 | 必須 | 11 (7+3) | 出来高算定の根拠量。 | `DECIMAL(10,3)` | `qty` が該当 |
| 基準単位 | 必須 | 3 | 単位コード。 | `CHAR(3)` | `unit_code` は `VARCHAR(3)` |
| 明細点数・金額 | 必須 | 12 | F ファイル由来点数/金額。 | `DECIMAL(12,0)` | `points` 列は整数（単位要確認） |
| 円・点区分 | 必須 | 1 | 1: 円, 0: 点。 | `CHAR(1)` | `yen_flag` で対応 |
| 出来高実績点数 | 必須 | 8 | 包括や逓減前の点数。 | `INTEGER` | **未実装** |
| 行為明細区分情報 | 必須 | 12 | 退院時処方区分などの結合コード。 | `CHAR(12)` | **未実装** |
| 行為点数 | 必須 | 8 | E ファイル由来の行為点数計。 | `INTEGER` | **未実装** |
| 行為薬剤料 | 必須 | 8 | E ファイル由来の薬剤点数計。 | `INTEGER` | **未実装** |
| 行為材料料 | 必須 | 8 | E ファイル由来の材料点数計。 | `INTEGER` | **未実装** |
| 行為回数 | 必須 | 3 | 実施回数。 | `SMALLINT` | **未実装** |
| 実施年月日 | 必須 | 8 | `YYYYMMDD`。 | `CHAR(8)`/`DATE` | `service_date` は `DATE` 型 |
| 病棟コード | 必須 | 10 | 病院独自コード。 | `CHAR(10)` | **未実装** |
| 入外区分 | 必須 | 1 | 入院 = 「0」。 | `CHAR(1)` | **未実装** |

**現行 DDL 差分**
- 基本キー列以外の大半が未定義、または桁数・データ型が公式仕様と一致していません。
- EF 外来（`raw.ef_outpatient`）は公式仕様の対象外であり、設計見直しが必要です。

---

## 5. D ファイル（包括レセプト情報）

### テーブル E: D ファイル包括診療明細情報

想定テーブル: `raw.d_file`

| 項目名 | 必須/条件 | 桁数 (最大) | 説明 | 推奨 Redshift 型 | 現行 DDL 対応 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| 施設コード | 必須 | 9 | 施設識別子。 | `CHAR(9)` | `raw.d_inclusive.facility_cd` |
| データ識別番号 | 必須 | 10 | 様式1 ID。 | `CHAR(10)` | `data_id` |
| 退院年月日 | 必須 | 8 | 継続中は `00000000`。 | `CHAR(8)`/`DATE` | **未実装** |
| 入院年月日 | 必須 | 8 | `YYYYMMDD`。 | `CHAR(8)`/`DATE` | **未実装** |
| データ区分 | 必須 | 2 | 01: 出来高理由, 93: 包括点数 等。 | `CHAR(2)` | **未実装** |
| 順序番号 | 必須 | 4 | | `INTEGER` | `segment_no` は SMALLINT のため再検討 |
| レセプト電算コード | 必須 | 9 | 930000000 等。 | `CHAR(9)` | **未実装** |
| 解釈番号 | 任意 | 8 | GR0 + 出来高理由コード 等。 | `VARCHAR(8)` | **未実装** |
| 診療行為名称 | 必須 | 254 | | `VARCHAR(254)` | **未実装** |
| 行為点数 | 必須 | 8 | 医療機関別係数乗算前。 | `INTEGER` | `inclusive_points` 列で近似（桁幅要調整） |
| 円・点区分 | 必須 | 1 | 1: 円 (食事のみ)、0: 点。 | `CHAR(1)` | **未実装** |
| 実施年月日 | 必須 | 8 | | `CHAR(8)`/`DATE` | `start_date`/`end_date` とは別に必要 |
| 算定開始日 | 包括算定期間のみ | 8 | DPC 適用開始日。 | `CHAR(8)`/`DATE` | `start_date` にて対応可（命名要調整） |
| 算定終了日 | 包括算定期間のみ | 8 | DPC 適用終了日。 | `CHAR(8)`/`DATE` | `end_date` にて対応可（命名要調整） |
| 算定起算日 | 包括算定期間のみ | 8 | 算定起算日。 | `CHAR(8)`/`DATE` | **未実装** |
| 分類番号 | 条件付 | 14 | 診断群分類番号。 | `CHAR(14)` | `dpc_code` として存在 |
| 医療機関別係数 | 包括算定期間のみ | 6 | 例: 1.1234。 | `DECIMAL(6,4)` | **未実装** |

**現行 DDL 差分**
- 包括点数・調整点数などは部分的に保持しているが、日付や区分、係数関連の列が不足。
- データ区分・レセプト電算コードなどキー情報が未定義。

---

## 6. H ファイル（日別患者情報）

### 6.1 テーブル F-1: H ファイル日別情報ヘッダ

想定テーブル: `raw.h_header`

| 項目名 | 必須/条件 | 桁数 | 説明 | 推奨 Redshift 型 | 現行 DDL 対応 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| 施設コード | 必須 | 9 | | `CHAR(9)` | `raw.h_daily.facility_cd` |
| 病棟コード | 必須 | 10 | 病院独自コード。 | `CHAR(10)` | **未実装** |
| データ識別番号 | 必須 | 10 | 様式1 ID。 | `CHAR(10)` | `data_id` |
| 退院年月日 | 必須 | 8 | 継続中は `00000000`。 | `CHAR(8)`/`DATE` | **未実装** |
| 入院年月日 | 必須 | 8 | | `CHAR(8)`/`DATE` | **未実装** |
| 実施年月日 | 必須 | 8 | 評価実施日。 | `CHAR(8)`/`DATE` | `eval_date` (`DATE`) |

### 6.2 テーブル F-2: H ファイル日別ペイロード詳細

想定テーブル: `raw.h_payload`

| 項目名 | 必須/条件 | 桁数 (最大) | 説明 | 推奨 Redshift 型 | 備考 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| レコード識別キー | 必須 | 複合 | テーブル F-1 の 6 項目を連結。 | `SUPER`/`VARCHAR` | |
| コード | 必須 | 可変 | ペイロード種別（例: `ASS0013`）。 | `VARCHAR(16)` | |
| バージョン | 必須 | 8 | 新設年度。 | `CHAR(8)` | |
| 連番 | 必須 | 1 (文字) | 規定外は「0」。 | `CHAR(1)` | |
| ペイロード 1..N | 条件 | コード/文字列 | コードで規定された評価項目。 | `VARCHAR(4000)` | |
| 看護必要度判定対象 (TAR0010 P1) | 必須 | 1 | 0: 判定対象、1: 短期滞在、… | `CHAR(1)` | |

**現行 DDL 差分**
- 病棟コードや退院年月日が欠落しているため、レコード識別キーを構成できません。
- ペイロードの多段列（コード・バージョン・連番等）が存在せず、`item_code`/`severity_score` のみ保持しています。

---

## 7. K ファイル（共通 ID 情報）

### テーブル G: K ファイル共通 ID

想定テーブル: `raw.k_common_id`

| 項目名 | 必須/条件 | 桁数 (最大) | 説明 | 推奨 Redshift 型 | 現行 DDL 対応 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| 施設コード | 必須 | 9 | | `CHAR(9)` | あり |
| データ識別番号 | 必須 | 10 | | `CHAR(10)` | あり |
| 入院年月日 | 必須 | 8 | | `CHAR(8)`/`DATE` | **未実装** |
| 退院年月日 | 必須 | 8 | | `CHAR(8)`/`DATE` | **未実装** |
| 実施年月 | 必須 | 6 | K ファイル生成用データ（`YYYYMM`）。 | `CHAR(6)` | **未実装** |
| 生年月 | 必須 | 6 | 生年月日から `YYYYMM`。 | `CHAR(6)` | `birth_month` は `DATE` 型（1 日固定）のため要変換 |
| 一次共通 ID | 必須 | 64 | 自動生成 ID。 | `VARCHAR(64)` | `common_patient_id` は 40 桁のため拡張要 |
| 保険者番号 | 必須 | 8 | | `CHAR(8)` | `insurer_no` は `VARCHAR(8)` |
| 被保険者記号 | 必須 | 38 (バイト) | 英数または漢字。 | `VARCHAR(76)` | **未実装** |
| 被保険者番号 | 必須 | 38 (バイト) | 英数または漢字。 | `VARCHAR(76)` | **要拡張**（`subscriber_no` は 8 桁） |
| 枝番 | 必須 | 2 | 半角英数字 2 文字以内。 | `CHAR(2)` | **未実装** |

**現行 DDL 差分**
- 入退院日、実施年月、保険者情報などが未定義。
- 一次共通 ID の桁数が不足しており、公式仕様に合わせた拡張が必要です。

---

## 8. 差分サマリと対応方針

| ファイル種別 | 現行テーブル | 主な不足項目 | 対応ステータス |
| :--- | :--- | :--- | :--- |
| 様式1 | `raw.y1_inpatient` | 回数管理番号、統括診療情報番号、ペイロード 1〜9 など | **要 DDL 改修**（ヘッダ/ペイロード分離） |
| 様式3 | `raw.y3_facility` | 調査年月 (6 桁)、URL、開設者コード、病床/看護関連項目 | **要 DDL 拡張** |
| 様式4 | `raw.y4_noncovered` | 入退院日、医療保険外区分の桁数調整 | **要 DDL 改修** |
| EF (入院) | `raw.ef_inpatient` | 退院年月日、データ区分、レセプト電算コードほか多数 | **要 DDL 再設計** |
| D ファイル | `raw.d_inclusive` | データ区分、レセプト電算コード、算定関連日付 | **要 DDL 再設計** |
| H ファイル | `raw.h_daily` | 病棟コード、退院年月日、ペイロード構造 | **要 DDL 再設計** |
| K ファイル | `raw.k_common_id` | 入退院日、実施年月、保険者記号番号、枝番、ID 桁数 | **要 DDL 拡張** |

### 今後の対応ガイド
1. **DDL 更新計画の作成**: 上記不足項目を満たすための `ddl/core/raw_tables.sql` 改修を行い、公式仕様の列を完全にカバーするテーブル構造へ変更する。
2. **ロード処理の影響評価**: `scripts/` や `dbt/` モデルで参照している列に影響が出るため、ロードスクリプト／モデルの修正範囲を洗い出す。
3. **データ型・桁数の整合性テスト**: モックデータを用意し、公式フォーマットから Redshift テーブルへ COPY する E2E テストを追加する。

---

以上の確認により、現行テーブル定義は 2025 年度 DPC 提出データ仕様と多数の差分があることが判明しました。次フェーズで DDL／ETL の全面改修が必要です。
